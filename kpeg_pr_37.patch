Patch by MSP-Greg
https://github.com/evanphx/kpeg/pull/37
diff --git a/kpeg-1.1.0/lib/kpeg/grammar.rb b/kpeg-1.1.0/lib/kpeg/grammar.rb
index fab8ad2..b7532f7 100644
--- a/kpeg-1.1.0/lib/kpeg/grammar.rb
+++ b/kpeg-1.1.0/lib/kpeg/grammar.rb
@@ -129,6 +129,12 @@ module KPeg
             end
           end
         end
+        # Windows - force to UTF-8 if reg contains a Unicode character property
+        # of the \p{**} style
+        if reg =~ /\{[LMNPSZC][c-u]?\}/ && RUBY_PLATFORM =~ /mswin|mingw/ &&
+            reg.encoding == Encoding::IBM437
+          reg.force_encoding('UTF-8')
+        end
 
         @regexp = Regexp.new(reg, flags, lang)
       else
